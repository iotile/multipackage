jobs:
  include:
    - stage: Test
      os: osx
      language: sh
      python: "3.6"
      name: "Mac OS - Python 3.6"
      addons:
        homebrew:
          packages:
            - python3
      before_install:
        - python3 -m pip install --upgrade pip wheel virtualenv
        - virtualenv venv -p python3
        - source venv/bin/activate
        - python --version
    - os: osx
      language: sh
      python: "2.7"
      name: "Mac OS - Python 2.7"
      before_install:
        - python -m pip install virtualenv
        - virtualenv venv -p python2
        - source venv/bin/activate
        - python --version
    - os: windows
      language: sh
      python: "3.6"
      name: "Windows - Python 3.6"
      before_install:
        - choco install python3 --version 3.6.5
        - export PATH="/c/Python36:/c/Python36/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel virtualenv
        - python --version
    - os: windows
      language: sh
      python: "2.7"
      name: "Windows - Python 2.7"
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python --version
    - os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Linux - Python 3.6"
    - os: linux
      dist: xenial
      python: "2.7"
      name: "Linux - Python 2.7"
      language: python

    - stage: "Deploy"
      if: branch = master AND type != pull_request
      script: python scripts/build_documentation.py
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Documentation to Github Pages"
      deploy:
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          committer-from-gh: true
          keep-history: true
          local-dir: built_docs
      env:
        - secure: QIojRNjseKkM6DhEJlorkgxkzN1+F6Bvi57qc3UEgNOTRWjsJmt1c5+5zkvdSrLWfdfsFzUEDddkj7VHR30ElqfhD/SlHOGoaZ0OWVzDz5WjEfXzZUtvIkXJPfJILqCpbtBVmsdg3hVBD9tPP8EqzwLdJENe/WeFEYuu7IV4Kzbx4n4X4jsImuoWtDG52TM/5K/JXue5LZoq6hwQhBCmb8urWxC7n/k50ZV6ri8POQxUmy6iHDmATG0sugySsalRcuXABYh2K7QhodjYwzgv0eVfoh6IFmbNbSN4JQ963FJHQXCe8Zv19Yia1oW6xWPrnMnrubfT3GE7x4+e/1KXGfI/jvngkTLgHdDJWkj9SkQrUSpl7+E2T0bMCo3T4e79FE0sjzeRKT2u7fy0DDfBkIVg0DTGD4g2RO4yO7EAtISlTDa8+w4xJG8oG+UoFCX3U+xLOt2JvHgogFn7sk3Q7hVhJ6rpnA3qzfk7EyaeSCWdsUPXCwwQ+m5KJsM7kw9aUfcJN9TVvirfW4x0a1q9yv0tBiwElT2m4y7tL5gfEizfEfkAyvoy5ehnG6Hi8UybMyoLfADAgr3AcoZbYBCMKpN4fA4LFcxe2blpuH58n25OWKp8ScpIDQSRSNGWwK2F69gAYRzZtgF1p7wRPzslZs/Jd0RkLdYXdJz0FmPUFR4=
    - if: branch = master AND tag IS present
      script: python scripts/release_by_name.py $TRAVIS_TAG
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Release to PyPI Index"
      env:
        - secure: jXQ/H52hhoT8MBWLDkjFq8ArEykvwN76rerA/L2TW/unlSGz/a7+rClmyY6e6UQXlyPdel1MWyizUkTiJZ1fkwgJOqZyYzf9VxmIKBzmm6LROIFiimXxu2N1NwgBsuxy+mOEg9aGsoFQNj6RPnF//px4/ZaXBURU/7CM3Z8GM0v+DVRiif7cXdmEbDLHStIni1l9D4/yBlK5W0RG7Mpbj0up+B6CDPE9H3UxIQsN1A2BwhGNt2QJ9hfWiBDW8g5tEL9WAs9qnjDXQPtJIt/wGeE8KJaB2mmGpOSsVXbKB9YQoTzN/zm2ZjL02sfnBxVT124OYXSoSR2iaRCm1yxPvDRUlmwQ9wZ16ObVWgDDK+24AYNPpldgvqMUgctQT9VQwSM7e0IlPT9GPCclNbuc/+BDr0UoMEwYxRHBpRdZTxlsJQgm56zQF1kMBaXruOl0K/A1EAigvsW/OToMCoVDoaaKYJCm+Ks8wq09Irh1/JHzUJqdETC/3YyJA1JOmk5rXZVxKWHaKaqMLTrW5py9kEkc63BAlWsBUoOKtzDyW47beVj53fdYUb4/QxZsdZPUjN5vFxPPRQL6hyUoFz4LvxK+byrQrxcqQ1Z7PMqxhE/vkaJhayvtIdEH5l4jSjwwGn5F0FoPQBv7mCaUKLWejOriKAEqDgVLW+S8qdPZP1Q=
        - secure: uCy/VfaZ72A6VdpePjG+K6+eOYuwTMQHAxXiQf57W/nF6XHPNH2A2QkyMfSqm91GwmNCqMf8PLowm/168mvAT8dOXoDVnVY9ubgmImjdxrt/YBJufXGvv+IyKW7aw1n4KWI7+2b83vPq89kUAdKyMg6rLSKn7plcHYPiA9QgJsI6wM+03ci8I6xQ7gKum+Me7YahVHhOOtIEExZpxmUpb5MB7kzew01KKIUdRYsNT4CKKx0mbUdNCFeqBu5SXJJ4b/W2oSLabUmbbF/kQftxp2GzGX2XKWxQKWYHMzOrQLMGnQ7QxO6wJqer5HJ/CM75FgySKDxz1eNL1oAWSGknWT/W6R0n1O0B3pC4FPhW1q31eBhtz4oQ45dl9k8UJnz1eFQgZ2APG5kJrnBT3ZAzwTtQYwy3AIee7dZzPPt5UkqzzpScCJyF5X553Hti9xErKrWd3hVxj4gNuyhkePWlgeYVnHxzgf87r+hP05V9D+ZlVMRNPD5oIINCvJSSjP+kCG8yQLO0spKbMlMBWtJe2lY2C6HwWEy4BJRVjUx/Wr0laNfVKGcvIdfpPIh3HJ7oINDps6BI5MXYzH9EuuGkoIOzq9rCmYuJz8lN3jpENcHJCR4e5bvURfzHlXITQIXlHO8brBn7hiVaNUszQu3+V2XTE4cwJEHlB6Z7mYRi3kE=
        - secure: JNp0jMeaTmYBCVTg6f19ONZcfGi7sko6PFR3V4BfeFgna2NZVc62QRigvfXMrw6vUjjMZVCRUnfgjFgSRo6WPVjFa4WEK6FYwQG/59lC4V7LAAK2JtE7DeCMkoChn5Np6fkXHLjDFGScJqS84LqS8aUBdxgN/rEpG7GWPL0px8+RxN06yyC0EOjOd6BFm7QcsGJX1f1z95hN1djBKYpZsFs1iUejIkwc34DoTjfzFPjuUOjLmEx3wWrZCVHF8iNE1SEPBMsfFasTc9PyUz1XrbStopum7CNTnv0V+Bx25IW0qOKQSRZZCzuzLLBJpzwvX8795wil78u5kx2qpYQuZambnmV1UA9NTbAIYWUZPN1TU7aj4Wjb3Aazsv3Z9D1wTXq02ozYl8u+76+rNwS5GJRxOa1Ltab7yGvijxGRBv3XRYXnbwoQePpoamcHqL4jHZKVEx9RLoWEwPPFZN+MakE/NGJKXShQYusfaHvrovE/Dp17aT/XNrFGYBzdXqTTz+NnftqVRcTQTJ5AG2jTvEVX/F8wcPV9C9bjAzX+6jHMjNZulS7UO3Hshfyd8SB2b2hdQL6QAI0T6lVcVgUgmcjkxf9UCVt74bRbU7zcrl7Uuq2jt9WaHsc4MtLsjSTWbqqhqKwvESMEOtld1VByfg/cwBGYp8/4oH78Qoj72DQ=

install:
- pip install -r requirements_build.txt -r requirements_doc.txt
- pip install ./

script:
- cd ./ && pwd && pytest test
- python scripts/build_documentation.py

notifications:
  email: false
  slack:
    rooms:
    - secure: jXQ/H52hhoT8MBWLDkjFq8ArEykvwN76rerA/L2TW/unlSGz/a7+rClmyY6e6UQXlyPdel1MWyizUkTiJZ1fkwgJOqZyYzf9VxmIKBzmm6LROIFiimXxu2N1NwgBsuxy+mOEg9aGsoFQNj6RPnF//px4/ZaXBURU/7CM3Z8GM0v+DVRiif7cXdmEbDLHStIni1l9D4/yBlK5W0RG7Mpbj0up+B6CDPE9H3UxIQsN1A2BwhGNt2QJ9hfWiBDW8g5tEL9WAs9qnjDXQPtJIt/wGeE8KJaB2mmGpOSsVXbKB9YQoTzN/zm2ZjL02sfnBxVT124OYXSoSR2iaRCm1yxPvDRUlmwQ9wZ16ObVWgDDK+24AYNPpldgvqMUgctQT9VQwSM7e0IlPT9GPCclNbuc/+BDr0UoMEwYxRHBpRdZTxlsJQgm56zQF1kMBaXruOl0K/A1EAigvsW/OToMCoVDoaaKYJCm+Ks8wq09Irh1/JHzUJqdETC/3YyJA1JOmk5rXZVxKWHaKaqMLTrW5py9kEkc63BAlWsBUoOKtzDyW47beVj53fdYUb4/QxZsdZPUjN5vFxPPRQL6hyUoFz4LvxK+byrQrxcqQ1Z7PMqxhE/vkaJhayvtIdEH5l4jSjwwGn5F0FoPQBv7mCaUKLWejOriKAEqDgVLW+S8qdPZP1Q=
    template:
    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} in PR <%{pull_request_url}|#%{pull_request_number}> by %{author} %{result} in %{elapsed_time}"
    on_success: always
    on_failure: always
