jobs:
  include:
    - stage: Test
      os: osx
      language: sh
      python: "3.6"
      name: "Mac OS - Python 3.6"
      addons:
        homebrew:
          packages:
            - python3
      before_install:
        - python3 -m pip install --upgrade pip wheel virtualenv
        - virtualenv venv -p python3
        - source venv/bin/activate
        - python --version
    - os: osx
      language: sh
      python: "2.7"
      name: "Mac OS - Python 2.7"
      before_install:
        - python -m pip install virtualenv
        - virtualenv venv -p python2
        - source venv/bin/activate
        - python --version
    - os: windows
      language: sh
      python: "3.6"
      name: "Windows - Python 3.6"
      before_install:
        - choco install python3 --version 3.6.5
        - export PATH="/c/Python36:/c/Python36/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel virtualenv
        - python --version
    - os: windows
      language: sh
      python: "2.7"
      name: "Windows - Python 2.7"
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python --version
    - os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Linux - Python 3.6"
    - os: linux
      dist: xenial
      python: "2.7"
      name: "Linux - Python 2.7"
      language: python

    - stage: "Deploy"
      if: branch = master AND type != pull_request
      script: python scripts/build_documentation.py
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Documentation to Github Pages"
      deploy:
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          committer-from-gh: true
          keep-history: true
          local-dir: built_docs
      env:
        - secure: pYESJpBOVGR5MSlrq6kNEM3xTFOBgIlFw/M6R96/IM9Ulbz0sjj69OFofJLcHU4hS5POWlUhR/H4ZvUGOX/myu9chPlPR8amygdxCxm8LDOmiJm7CP27fjjT8QVM28h+UwNKHZEpLYzqR0TXEKnCjDK/Mt3VaHuwIFIqsr72Ve78qOdsqhU9E0tWJukFGY6ShMJf8fp6gDrrDPMXgkyZyya9EdtrxVpqOQ/VnRIzrG69wc1Y+COWc1B2w5OqTQj0C6TYPzrzQrmfc3Wi3d1Kqe7Ojn5If5NJa/by9SdU5+gcLIYROwLfimWUQeZDA1FfoIyZYU81MBzZyoR9Oh/vpFVGjQRJmx2Dby+8+qbK21aN4RqMkpLxiRoUUNocRJ14bQaEawC838vxewnkil4sUBP+ymK9vTkyMKcJULk5pI5KcF33PDSuVCopShl47YoCn7zhkoiYHrGxNKjmFF39l62Rzhs1VwqbGtD7z/Gvl/kXZ2sjeevu/A8FjhtlIxg+Q4xmA2S5YQ1d5kEXHzc38efJiTEjG3mUAFtSWtyPrnCc8C6iOhH63h98BijlQ+QUvCMCLO3r2W7yFxzGo94O1QkCJ8J9GKBSYScMSsmCr+TDl8Bz1DmUCP8NAqPQgmt5Ehhp2BNpmsRxx6VzXGY8uzqUubCfBhzP+ikYu5+fOBI=
    - stage: "Deploy"
      if: tag IS present
      script: python scripts/release_by_name.py $TRAVIS_TAG
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Release to PyPI Index"
      env:
        - secure: ZCkf0AE5dpsRC9KQHNDMTnljx8AO9zOf5am+6Agb3lV8s+wsX56zZIqu4KZk1oB0CRYWH/4KIjR9/keWxj03SFDmYullvLgrw2hh6IRleVpgM2KEVi+t5AtwGqjJcwtlnpV4piHI5BdKUKqe/pvHYL5L/ZRbwYmr0P5ocPnUwjc0MVwvpu9yV6PeR2V6PWtFWpzt05oTUajd2G1K+0l2YEB19EG/JEeUQgjeVlCuQtRYzMeTJk5G3aLpGv3/hivi36yn5rYcOlSnuNru2iF+euhf31k+rpOZCrJQWrUa41TzYXFbfeFhUcC1Q6mZIQ1RjIIss3JsOk29F7K4Y+j6Sc/0jo0EAa7sKNR1VHyqPYHhX7UAvoh1ixVvUlMHMcT2MFJ5LrdfIv+P0b0dTVWBCEyuUfTOwpETUe3tzMh344Z5O1q774xxsoVhVv32lgN4xUVV9+yPD33jHTD6dvF+arItDWzkAgO/XmOjXXL5cY9Ugt3pL3mR0CXJEdq9zRwUT4gj85g2gi3rc3V0yU7sfk7C0YLGUv+pvAo8JOm509vo+K6LcBGsZZ+nHNys4mqp0+UjMekgxhqT+Hicjvvkd4cM7HGDkE0LX+MWMjYGBMB1jTS/PMDQhnc2TpjaebLhkpZfdUfishwNy9dFoP8R0wb/W1639HZgiGIoPTZ1I+c=
        - secure: UlMrHe/ve+DuR7bqph+Xbvbw5FIEi7l1XEmVQ8ELVM0jV0d7B11+0o7C7joDENKBgZaxZyaqXNW8BCNem37IgkhleE3T6xoufcdigtWwa04ticZTzVgs2rZd+4LjF+aKUQ4SqXCiaYJ+GCGANMaoVsqDdXMJxQ9b4LgRQLtBWGRMckkiZDGdgIbVIE6N9uxub0slTUIVkZQTOLg31RPMRPdGaA5CXLI7tvgUEJmFI2NlGfPGiMLCi3jpRcXgJB8uL5Y6Fc6MTBHVeMcWhug/XIhGPcQhNiXpKf3TQO41D2Rw4NDKPROOejeouKBSd9j3Ogbp4wCGZ7A7TpWZZFJK/Xud2k0IsilQtj9C4NQ1WJiRv9/QXVgjJzVrgF0EXxVHhfG/BAOnZfxqgFOQ32UxEFtGsc1e9DRHimQ+u1zf1rADqerC1OBTw0YfElJj/H6yoGy8FY08Y8+SbtGcOgXMqu7onJILb4DvtlphyoYhlI+oFHN8VJwYxVLJwMGohoVJjAvoQ/lEVq9DtmkXZXpVvF6nMv3VCFDipT/p8brEgDe1ugbd6TRWXJBxk/Hkv3PvQFfK1ppZGy4nH66DMxxClFRGgTduEyFIuXhUcNRQMIJ0ZydLB5/NQeccrxoJyBhsloewIpg9yeyac7legpA+GQ9k7sRxHm8yMfwhzJ+Yqys=
        - secure: ObRRApV08lHu6h+EBMZGd1IZ+bL4gg3w9tu2aBgQenDkMVvIb4n29acEWcjsDIcSTQnxbsG7vlT6F0QKaLyLxl5KXdDIZjfhDsvrJWBFFfM79X/rsMPh5IRSHxHskwE/JRtkbYxBe9q2BaHQ4T5XfFWUmh/d+/lUZJbfXlou8Cur2Y4BR+OeAo2s0ZKNmTwBlkuswUMjMLtDIoeIeM0rI+NPOQYvuhzSgLKzZWPHWdU5/Cq4JvazW3C0I8MMhauWVH9OtmhHFkJJX3SdXpdPi67oEsU8yqCIXkI2XjkT9ObJxeZh0kRoG9uVtV2W/pWbI6aZlnVgwDe99WidOU65EA+QbQwxVvt0ttsmV+HWpfcHja+aJLchcX8g6779Swu7ZvHy8SQEGVgmleP3bS0IHJldNns0JNMyarVyZsfjASXCUadQqjhWH48P6Me43ivKhXb3P7n418dKRDF1zb7ocTh27jp5DY+HnxfyjWNofQiJJIM/jDbCpleoc/n1wHPredYliYXhShJp6tdwqE/piGqLRnt645OxgPhczL7yClpW+czWlHqqYmFl3WNOZZsdtVJgTKz3FaFLqAOVbFb4MsQEzVGnDUCg9hTlDfhrur4/3JoyS23vsP0XjNOilDlosPynFTMBQnt8O+oPMUyBJeOzc6MYskaqao3A6Oc+ZBw=

install:
- pip install -r requirements_build.txt -r requirements_doc.txt
- pip install ./

script:
- cd ./ && pwd && pytest test
- python scripts/build_documentation.py

notifications:
  email: false
  slack:
    rooms:
    - secure: BD1LO2TMx92XLtEDr6ExDQhO0td+blKWQi4proOS/weIFtbW+U0Gcln9QaGA6w6T8rj9MX/9l4mvJ7aDLnOoh7N1ncryqT5A3Rc+DUCto/+f/rCkqtGJGUyIsQ2z5SkyTcu3nBLXDXiaoYcUEwFZooP2tqh3SZwa6ELre0KXYNykViJT2WZbguwV7W2m74Wy+EO99sx1cdbhz80Yvc5ECDJRx/4PVBeo+8CyU21JXwGDTSsdYiTUUMfmjkGUmI9G1jOQTa78cD3ZpLv7GLKAqi8JOzKctA/zjMySyIcg7SL7Nsms5mSDmHug+eDxZagu9IER8RBIfZMPF6azouJvZcwqxHjqJgwU+zhQ2EvstETu5qS9oAPTP0U8tyL4SBgGbQhe4/gnBhlOMzeQLpVaKzpZmhdIvpk5yg7gbyzeq9rEfsFpCGHE71c+N04v7EcgE4fSvNHtyecQlCS7YgxYaBbi/kcGfmKWXML0XHl9nE82CYMNMBBBqispNboNFaShM7RcK8AgWFTJ8KQ27c/+lhatAnf/hHgoJzYuStoyReFH5Kthr9dlhtlBC2i53oSiffEmhSDva0cWhKGUzlRAA5NJyCDebjELnL+a/KXndXWMzwxJlO+B0Ah+VJKS8K0Zz83/wh64VzyLrzApptju5Aeot2J7o4ZP1+RS/XDorjE=
    template:
    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} in PR <%{pull_request_url}|#%{pull_request_number}> by %{author} %{result} in %{elapsed_time}"
    on_success: always
    on_failure: always
