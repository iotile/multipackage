jobs:
  include:
    - stage: Test
      os: osx
      language: sh
      python: "3.6"
      name: "Mac OS - Python 3.6"
      addons:
        homebrew:
          packages:
            - python3
      before_install:
        - python3 -m pip install --upgrade pip wheel virtualenv
        - virtualenv venv -p python3
        - source venv/bin/activate
        - python --version
    - os: osx
      language: sh
      python: "2.7"
      name: "Mac OS - Python 2.7"
      before_install:
        - python -m pip install virtualenv
        - virtualenv venv -p python2
        - source venv/bin/activate
        - python --version
    - os: windows
      language: sh
      python: "3.6"
      name: "Windows - Python 3.6"
      before_install:
        - choco install python3 --version 3.6.5
        - export PATH="/c/Python36:/c/Python36/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel virtualenv
        - python --version
    - os: windows
      language: sh
      python: "2.7"
      name: "Windows - Python 2.7"
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python --version
    - os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Linux - Python 3.6"
    - os: linux
      dist: xenial
      python: "2.7"
      name: "Linux - Python 2.7"
      language: python

    - stage: "Deploy"
      if: branch = master AND type != pull_request
      script: python scripts/build_documentation.py
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Documentation to Github Pages"
      deploy:
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          committer-from-gh: true
          keep-history: true
          local-dir: built_docs
      env:
        - secure: uZEapLJ8/Qq0Q053Ic+A9Y2uaGGcobmylxkRYYKgE1KSk+JKJ13Es0cAz+7hYCnEIP/D52Pgf8YaIGbqesP3JWe+/eMd+2Jv+o2eInqncWcoTOz6TuAZ5fEbSi7FtxD6i3bwRyNzCKOayIOTXCr1QdjsEGXQ1+lmGSmOMQwLt2oBMG+FiyjZJSELqvdJgWA876XjaVGpbkkKW+vE5jZuHDowvkSRll5p7bucXaO/kwf91XPWKbMOBzybk/YJhVQDPw70oG/vyeJPXOLYwTCgY9L6aWmBvDNuUOJf5WP36bppm4qB2AAH8Yrxcb4LEg3f5NNaTL7u9dRapKGaTaoKP5je7l4sTCHGCPahWN0wRPcxrxfyMXf4d+yUUKd38NnIS1qcbsELsc8bDEuv0hYPvTwNqTGj3PLxsZB9RJJOZ64aCaZNOxf1XWnIUOFS+lGwh2IJXEMwBBOouet5B4JdjFT97lSVZtrZ6OD/KJBYcx1JYmFr++HN53aIyZeK+hy0NaPdtMfE1Qq7SYzYXlTIGhQ99afAJ6/cCJ56G1/mRa7doh4reDTZ9zMrpOny2WaMMwiCbXJYPGW1rTn5TWgCpZ8BwMmX3Fdayfmf5Vtu6lzFw6pXCIxOKzUSRtq4ch7i6uaA/btHCsPl4S4qeCp5iA3y0z/eYYjpe4bTdHFNM1U=

install:
- pip install -r requirements_build.txt -r requirements_doc.txt
- pip install ./

script:
- cd ./ && pwd && pytest test
- python scripts/build_documentation.py

notifications:
  email: false
  slack:
    rooms:
    - secure: "BLOmzN4BVQK8b6LCnXd51PvwGs/k2vEXISGcFj+CJjJJh1xvAWK94R/FMeSxTL19hzhLwLYVhQMZoFPIndt7csOHWkuMGzybbWEqD0JRKK686y7qrpU0/T+HRXPmNP+VOmDAcNDP0mTNPqyNEYsdcShI2/FHvIWx75Ap5PuSl1K3qLtG/1RHCMRNjpKv+Ac3p0VDVHVMWi5UEOEv4FGc1bPje10oF98JF3NU2qDeJHwJmYUUsi/fM/ylnnfWCnX/muS1Fm3rbrc4YYGcPfcu4oWl89yg6y1Lzo3agN6idu7gmFwbvv7NjHWDls8LMhxpbnXhc3XiHFBOktZRRD0sxqtc+hPHZfT5WV+cvWX9PyrV4HPKimntf7/wDheL7HSARBpZpD559hntNtNldTa5EWe5alPf6edza8W/heGi5CJZwc6Tp0ZtxXfHyzeqQ8lRDM/UP4fQF5h5CzNy66pRx2e7D5DSd5RLpLKIgoUfAMcQ+dt9kRgpUW685zorplA/lWxBfTCxv9rXMImMKNBn4KA87WcjMpQzQVoV49gsTVEsQZRhgZwv+Y6PIF0sN6Ic0tNIcWDEL5DtFeColhC/hCQEKonvnoK3h6zjB/zsYhFDI5PnsZ/LCbThH5DRDr+UhZtDpJgTvJxl90ybz4OkOb3WP6qM7s6pO4AhDkDiUug="
    template:
    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} in PR <%{pull_request_url}|#%{pull_request_number}> by %{author} %{result} in %{elapsed_time}"
    on_success: always
    on_failure: always