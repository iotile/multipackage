jobs:
  include:
    - stage: Test
      os: osx
      language: sh
      python: "3.6"
      name: "Mac OS - Python 3.6"
      addons:
        homebrew:
          packages:
            - python3
      before_install:
        - python3 -m pip install --upgrade pip wheel virtualenv
        - virtualenv venv -p python3
        - source venv/bin/activate
        - python --version
    - os: osx
      language: sh
      python: "2.7"
      name: "Mac OS - Python 2.7"
      before_install:
        - python -m pip install virtualenv
        - virtualenv venv -p python2
        - source venv/bin/activate
        - python --version
    - os: windows
      language: sh
      python: "3.6"
      name: "Windows - Python 3.6"
      before_install:
        - choco install python3 --version 3.6.5
        - export PATH="/c/Python36:/c/Python36/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel virtualenv
        - python --version
    - os: windows
      language: sh
      python: "2.7"
      name: "Windows - Python 2.7"
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python --version
    - os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Linux - Python 3.6"
    - os: linux
      dist: xenial
      python: "2.7"
      name: "Linux - Python 2.7"
      language: python

    - stage: "Deploy"
      if: branch = master AND type != pull_request
      script: python scripts/build_documentation.py
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Documentation to Github Pages"
      deploy:
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          committer-from-gh: true
          keep-history: true
          local-dir: built_docs
      env:
        - secure: k9gJi9sRXIPR2sP02m02ycXipaNWBm8u9HtZAhFSs2TklughoGhoytGQjDKBtRds3Ui77UtAicvkd0Y9C9n09Spei4rPTi9oQEH/je7YEwkswom9MM24uuVTzWS9LFVhqmYcRe1BNKtEwxqiT4VyKYCmEJYShcdzCqNqqpA6++BBWv/MfXyY0yp3F0nH5+1ppdHO2S37MwV9CYWqF6RVkKcesgNWJBWFw9eSRECONCSSQE06F7YJnFRNs89rescOoikA7ln7TjjosZd3YPed9KfM/OGsOfEH2g+x9vnBW4pfZxCwtqh1af16D50PRiwTuY1bPWq2pgHL9RMGnPnHmWwKe6j1GEA0KPOBzf+ZavPpTAuHMiPLBS7U4wXGhZPq+TdivmWfpQ6Qz8FQwDuBRA8u4n9iyA8WOkMBS0euvuAQrP4jjsxcWT4PEseatebJ0jAyZMin71Wy4zRT9V3lZfeaAQZi9LSNcZLnlsShUe9FSwAlohQk7uDpxjQrfOfl0pD3CA6+1kaf35+efBQ48EYW+9sbR4IH8oRR6eZJl9XNqLoXTXPwHKNEhGJG6i03XSyi6E9UNxOpkvVPLrZiM+f8xrcILAzsXI/X4aIQMBON3LVIFoa0ls7XyQ4JaYXcA6Hi2bzUHPsCrK9/zJ9S/G1htEO3IWa2lIuNiFG01so=

install:
- pip install -r requirements_build.txt -r requirements_doc.txt
- pip install ./

script:
- cd ./ && pwd && pytest test
- python scripts/build_documentation.py

notifications:
  email: false
  slack:
    rooms:
    - secure: RH2lncFqCJzlNYc/u19gK/PnSUD1oPSfuD5e18RmyjMAohhu5ZHXKa6tbetZvchma17GdgNzMyTv5D2L3bOiifXT00HNe10tbOCmepCiKDNVsllqsf42TPDwH86AZrjE8VsVwjTtMGazjAa3/GBUrxEI/6TItOrVpkk4MjQHbMqNH+LLdwaJEvgfP4RMM0+cNp9Ig8R4L5xNnobbyn/m5/isISpD84Gby0cnNGROJACY/TEEoYWOxMdhxMfBZQygxIkdUqendMQ7RmjkuR5irOfmzmm+OnIEXxctqTCPyp0iLCwXKdgkwnEurmsXuwXlWTS2vpSL9WQJTCNqxYi80N+GMWbAAC7xylszUiNA7UJ7dPSNovztypritVX6KeqZ64o3O/r8GLUvw0enrnhpx75hbmBQqx2Y9gna6clwzYFXVMXnGJ+2AAb44eXkMllUi6AEj4PNkF/DkzHcPuL8x1SzNuyxnAOjPNrgpoZGp4QbNnugtTrtSXIfd9oc2K5aOXxAbUlCUvrjqQyzlUC+ixGap8RpRlNubaekFz05un9yGLhjEHqSqWSc5Y5gDec4vHwIdHQdhYOifvH+pcZaYZTy4o57b1A5c77GPraXf9YixDhLsldHjn80IuiJFmtAfMZXeFCbgK61V3bpU9zUjyLUvgiQ3O8AgYktOamGuv4=
    template:
    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} in PR <%{pull_request_url}|#%{pull_request_number}> by %{author} %{result} in %{elapsed_time}"
    on_success: always
    on_failure: always