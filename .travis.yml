jobs:
  include:
    - stage: Test
      os: osx
      language: sh
      python: "3.6"
      name: "Mac OS - Python 3.6"
      addons:
        homebrew:
          packages:
            - python3
      before_install:
        - python3 -m pip install --upgrade pip wheel virtualenv
        - virtualenv venv -p python3
        - source venv/bin/activate
        - python --version
    - os: osx
      language: sh
      python: "2.7"
      name: "Mac OS - Python 2.7"
      before_install:
        - python -m pip install virtualenv
        - virtualenv venv -p python2
        - source venv/bin/activate
        - python --version
    - os: windows
      language: sh
      python: "3.6"
      name: "Windows - Python 3.6"
      before_install:
        - choco install python3 --version 3.6.5
        - export PATH="/c/Python36:/c/Python36/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel virtualenv
        - python --version
    - os: windows
      language: sh
      python: "2.7"
      name: "Windows - Python 2.7"
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python --version
    - os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Linux - Python 3.6"
    - os: linux
      dist: xenial
      python: "2.7"
      name: "Linux - Python 2.7"
      language: python

    - stage: "Deploy"
      if: branch = master AND type != pull_request
      script: python scripts/build_documentation.py
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Documentation to Github Pages"
      deploy:
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          committer-from-gh: true
          keep-history: true
          local-dir: built_docs
      env:
        - secure: JCge7gmP8Wk1Qh5U3sNk+NMAt8lCKVFcRllTijJP5LzDEKdHA6fHhfBRNZqfFNUbndzrOuFTqMZLwAAo1PvOdufAYUoxdExdxDPN97YaVRxwj/La6dGygnBtk8RyrRSBqG7f8ZuC9DG8TRLq+pz03woMugEbdnyZsrtVSCdBysRC56QuY4IPEF+8CrU+oqIyiSwHyJd/XwIs2OMlnNXN6mKfeCjoCpZzK18nUuRzPjFh1h5dWQnjcQV2hRBU2Tp8uZpz9i3HgIQuD0GEGiItSTbvWt/W6faSkQI47hqqbNEcNmLmlxzothok4QBl+atkRv5zXBKLYYjtIPWHusIghpuhEqMXHrnui5B24RJWQrLMv9n504b4AUxRjmNaw/6J8zWks5aCfLmJINEIvQN/9GEhJ0Y+eOsmIZcWj3l9R2MLM3hA60asAdXWU2cPxuGB6KU6r14uzuks1znPALZ9TGK7a8bGAfG0xgN7ZBP9+5qfkIU/gLsGUS5wagz7hXL3k91MUmYloccHT8Gnoy0nl2dn3jQOq1xczrlfXl8e+Rp7ltlGIpeoSIS/D0l2RJcFjLN5HJEQGCxhTMEHx30NCiQBWNCoEhV31o8MQ/G5AOdlPKO2r7utLd88y/0ouXFIrD4YQOGKG80qMfpQUj3HGyNBPxh/itXQJY8CHVYkvKM=

install:
- pip install -r requirements_build.txt -r requirements_doc.txt
- pip install ./

script:
- cd ./ && pwd && pytest test
- python scripts/build_documentation.py

notifications:
  email: false
  slack:
    rooms:
    - secure: FVMqjK5RZWCmzqct5Stn7wq6ztTnRRlRQdA1JQC51stzxO651aTsrIh6yuksqE2ZVgMZWSRDiDFie9rBIAzes4NSumEC6ofnIyOuy0+VH+nJ8iV9m3oLxEnK1AIeSuUmk0FhFwdNZKMgFDBlyngR2DsqGblMKYTgI4eQsr/LL7RutfvOXmFk0OF56ouvmogdIi5fA79xMDobrjm/RGf7ikK+Z6ntZcG87R3YMpCtlnm9DVW5NB7DFxKVPcWhhGPAtDNR2wjNK25eGsnpao1HB/nwpHP1s2mZnJJQ2GjxVqU7QDGwyDYEQbvhxNh8sf0pxesu55lZ4Z7f05rzWHl+WNnHQVd/WaznoqkiAcCHxCKh7H+7kwb6yZW0Xq4/iMGfk64Q7aLUkbb6exeVi9oC0ujKCkTzHWDiDmXOXCkdOaQPxyfh3mNTQQ5p3Fu7X/Ag4WWFwbvhfXe0YterZxJyKAZ03E6kykIC1OK0ybvZF2icEGpnfY4jHC5IDUsy+iMlSMG5ePN9SNMoQXWFOpmsmuBD8BnkkviYwRaLjMCAT6GHq//Ni3XXFwMjj0Chta8ul6lLlbYWoHnmqHIxDoSYdr+qaaqS/yWa7yuadPO+R82q4m2mj5uQPEhNW34z7zFCU+l4eWoxdbLldJ9iS0gWxYxVXDUD1EMd6/Rc9qM+frE=
    template:
    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} in PR <%{pull_request_url}|#%{pull_request_number}> by %{author} %{result} in %{elapsed_time}"
    on_success: always
    on_failure: always