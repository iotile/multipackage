jobs:
  include:
    - stage: Test
      os: osx
      language: sh
      python: "3.6"
      name: "Mac OS - Python 3.6"
      addons:
        homebrew:
          packages:
            - python3
      before_install:
        - python3 -m pip install --upgrade pip wheel virtualenv
        - virtualenv venv -p python3
        - source venv/bin/activate
        - python --version
    - os: osx
      language: sh
      python: "2.7"
      name: "Mac OS - Python 2.7"
      before_install:
        - python -m pip install virtualenv
        - virtualenv venv -p python2
        - source venv/bin/activate
        - python --version
    - os: windows
      language: sh
      python: "3.6"
      name: "Windows - Python 3.6"
      before_install:
        - choco install python3 --version 3.6.5
        - export PATH="/c/Python36:/c/Python36/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel virtualenv
        - python --version
    - os: windows
      language: sh
      python: "2.7"
      name: "Windows - Python 2.7"
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python --version
    - os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Linux - Python 3.6"
    - os: linux
      dist: xenial
      python: "2.7"
      name: "Linux - Python 2.7"
      language: python

    - stage: "Deploy"
      if: branch = master AND type != pull_request
      script: python .multipackage/scripts/build_documentation.py
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Documentation to Github Pages"
      deploy:
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          committer-from-gh: true
          keep-history: true
          local-dir: built_docs
      env:
        - secure: B2tb+8O+GnRl78EgbJ4AVyH+pK2A0IUX7SUiw3/lH24ZRXqdSyexzONaMmxJGP3XUvBzzpNupbJmhcOOh7qk1JSyxnjMpS66W+gShiI2nystB5NEAfQZySNATp8ii00VsFYXbNm6Wbpkh6G7yjB4DsgWYBTSj+DlePG+HHuA9zcB5kDe5f6tNWC8nQ/rLKhFMFZl2qIS6iFpyF1nyvBPoTPQ4e0J06+feIHmQo/DDhxcjO0mej0elRSffTc9YJvpj5EIpJGjYVxqI5uq3zQWU3xYeGUDB4q6QWkDfmMlEUjIVyjDuJSPIX0omNNjggsdnyjEUWyWWrqAbZMl8w2EqZVH3y2cJKlZFPtLki+zie9jPBmqMEaHVUJ4xYkJwiEzIeLSDPdDNFMntFTQnHH+RdE3FmxiZISpfhhW39lkQ/PUNCMUuWPXm9FyX4WlxT1c9O5QVHsrrpqHwDOU2IlkaHpIVhSNTZC9dMSVPSikKJsYHWcFv4EXXoS1Egujco6YljZaCr3SPHZ3YHeGSo0QiWlBWQgUn8loySSXMx8aAZYuFvavXWewaYNEeJmJVwHLQmipmhJeV73Skcr2Ep6HIkIPlwbe0f8pJ1yGB+VCBOSwd76jR4KRr+hp2FIhAl6eMQ2he4DMNzUY3E+hcIyBhwFZGTvy4gcXFfya4qnJPKo=
    - stage: "Deploy"
      if: tag IS present
      script: python .multipackage/scripts/release_by_name.py $TRAVIS_TAG
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Release to PyPI Index"
      env:
        - secure: UWgwZYq0xUhr/fWPMQ4AuEmhZCXAv70oPTxwCw/3KRBJNZHgJgUoEw6qHSjgvswtKeXQdLE639oDXMT5fkgHoNqSyGZSBuLISxU/JK9qAIISgI5rkHFKKhGniEBtMyImnPBU4CJiEzrkBM3lovu2wDXVqukTG6QFlv4UqXLkyayh0GhqVNzYZ5cl0tfqt/c3442CB+EqdRg4ZLjNcPH6dqXr1nvVb4VcC90RDWbPoL8PiYVY9izpLtqHb8dFhp0ClkrMQjI0S2di20MqDlf6ikp2Iw2+/G8d5pPmCQpEtg7vlDzFp8oKnFqqaI3p5Gj1j1XRY4C8fbSK9Jf25eq0W5Y3Onda5P45uEcMa2Q5FGfWN9FJhlQMzWveqlHRv5mg/uGtmsEknSeR1VQdtajrr6DC6OUMn+f3fXQ58jCtmJxXzPxjIUhVnE9vzafqxzX1CS4Tlp/yXTNRtJ7U34onom5P+xmEj/NNok34xZHbgC6/Zg3fMEj3iukU9fePRAlXW2k25IwXQFV19zMDYWfd3TQwsRI6RmdTPuAgXXlWSJtkT+hZbi8LgOcx/QRkEXh15NA65y8cUruWe6m/hznaEGHhiItwI1KskTssNNnECZMwc8WX76LkhpN7QKySr9zYEWeiKVCVoWwD+S3Qfyn7uOPFQdyPdLcXAgEbKMULI2A=
        - secure: qWUiYhtv26cBibyIcGR7Uad2GRsOBN4sLi5iKT7jpx4VsqDafJ4fbw+8RE7uZC4Rl2veSz9ofVXz/GxuBvTD1wAshZaSMN651lWdZb7aZ0sttlhvdq78/corNGZqq32UoV2TEbynSZ5zBLY2bQ7PiXH4aruKpJTWaDxlt2q5fN8M4yx2L1PP0FijJNJ2TnzqX/oD5+uwcVU7NYTccm4cSHW/7GidvvNelMAyH6Ei3MsCeMn9AtUNxu5+xLwlqGRMJIWyWaZRTIvmJAMAGwr7zLvbi1re1w6uQYPIih/97MpK7HPJ80hMDfwR+5ZhC4JuHQKXxyrQ0XJejxn0zJ9q9Tcwecp9TJcL0Csxh6Mx3AbH44otd9szCoTwFXKfm1yJ8S99Q2xelimAyaIKOqlp5kC2ddRE22/LXudurF0CwA4XNLT6va0Mxq46aTofUV/Bejtmjj31g+kYv7PEPVSX/x63e7dhnXdSasqoeQP1qRIlz7ruDyEQFmuTAFI3vBL5CRCs9wg0a53NHYzmedfQErS38jdlJdjAefAW1MeIXCt/vGPYLk+Tx/FGn0xePwlfWdEQqCBXyGyqcIhca9cxtM0r7wZXagxtKo5DUN8/9a1dflREBnYjy15CCD6PdloVcwXbuQO93BPB8Va8mbhqHEpN5l5HXyi/NPeRhPnCpxU=
        - secure: OID9VTGLoqJ41jnynqyRHOqQkP+pdUfr9HqLAKmAf+zo4kT6DYwa6FnQCq1Xp6eG690ujeGfLFbEE3iT8qhLLbUjuF3nw1eeKRspKQY1kU5ElidTtz2kSqVu2Cs71vcNFEg97kCuhTWdniwy20Je9D4aitJUSw1eAtSB2ztF+od4NSFNPlAMb1I945ptSvGRCG2ETrscH0ayTdrg0OBDOicJlAzNkjAD5VaC53jJliT7B8JSKENVR+/vLt/NbT2FMBH2Se/7W7J/8Y4RfRIGjuuL3MTysHb7JMX+Zlt9ip0Gbtt5ZrkmUmQfddTKq8hgcr/Xo91oFvAXndQ6duQf86Oiw/fIwtFKe1yPQ904/LMlhcR0wPOuNlSz10ZEn11QXVV/UyPt81oVBh2jnX3mbQcGdGutapkig8P+vNyFMgTgdsA6d4OdVXNYBiF7Pl/lw+Eg0E9JWR7Cr5yXTcV4GC5/jTFQmOXot69ro82lj0oqRBD0lvASb+jG64u+V6uarh19XZw/6UzcTLWDM2sexuv/BOslSpqN5TPG4I4dIp45YLLnUYC32kVDahk4lm+I5ub20gVtVUOhKwE45dSBJye7FzsDtxPz00ygeVUCyeipR94bwIK6uZ3CgNvLMCimCQQzE9k86bCGY1ar+YI5j9hIdtiuUM3q6Y0VkejP1zE=

install:
- pip install -r requirements_build.txt -r requirements_doc.txt
- pip install ./

script:
- cd ./ && pwd && pytest test
- python .multipackage/scripts/build_documentation.py

notifications:
  email: false
  slack:
    rooms:
    - secure: uVfSabIsRbWw7XvQC0TY7aSPPinabKc4m61IlxAChUMJZz2vlfN4QXZdBA1TLmnqVG4H2nHIaHihWnAwA+lDsxzOyZt+E0rXJwxHGNxtLScyZ/DYOJqw48ExHc/BiyykkSt0Ywzu6XMKZ1howGn8y/4amLx9FtObeOi8ZQxNDSC67LxH5RJ6UmekvyPRfKU+K9bWbQ5CbMMImx/MlA3+k06vmwlY8inEoVWjeDTgfadKFjtkPhiWkNwpMQQEEpFw9Mq/1IkxuSeZiTtNCbdxODFJC+zrRa61mF5P/TO2qlwbsIaUOGkULJuimVIJmzqvuZvC3LkxFZYRs/uPvL2KnhITyAuMLwreJ/X7ph2eTzoW+wLUA/xKvAyBtdZ3m4XMzG6H7zFNKWbEgub1s2E7G62BtI2TZTaRyF5sdtEsV/ubHg79k+tEgfNLuLRROlBIBw4AEory45/3barjvB2rYFlAls+zLMG4iX+csSxpOOgxhcFf5bzk8uAeIJXJL7W8BIWh+Vg/dbpYdrbXNKPjlutsAwf/3xapbFdFL+qDjhUKeyax+BrBhZ4vWNbbeHb8eghMMOLRUVfytSMA9/I0qmehm8B9bcGG4yOB14C+7W4vkXIIJgJjOx5+bWgXD9czOQ6fr3ey+xK1wd5WX7hqf/+BirPNCXrumxFnLEfjXBY=
    template:
    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} in PR <%{pull_request_url}|#%{pull_request_number}> by %{author} %{result} in %{elapsed_time}"
    on_success: always
    on_failure: always
