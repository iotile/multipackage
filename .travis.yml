jobs:
  include:
    - stage: Test
      os: osx
      language: sh
      python: "3.6"
      name: "Mac OS - Python 3.6"
      addons:
        homebrew:
          packages:
            - python3
      before_install:
        - python3 -m pip install --upgrade pip wheel virtualenv
        - virtualenv venv -p python3
        - source venv/bin/activate
        - python --version
    - os: osx
      language: sh
      python: "2.7"
      name: "Mac OS - Python 2.7"
      before_install:
        - python -m pip install virtualenv
        - virtualenv venv -p python2
        - source venv/bin/activate
        - python --version
    - os: windows
      language: sh
      python: "3.6"
      name: "Windows - Python 3.6"
      before_install:
        - choco install python3 --version 3.6.5
        - export PATH="/c/Python36:/c/Python36/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel virtualenv
        - python --version
    - os: windows
      language: sh
      python: "2.7"
      name: "Windows - Python 2.7"
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python --version
    - os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Linux - Python 3.6"
    - os: linux
      dist: xenial
      python: "2.7"
      name: "Linux - Python 2.7"
      language: python

    - stage: "Deploy"
      if: branch = master AND type != pull_request
      script: python scripts/build_documentation.py
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Documentation to Github Pages"
      deploy:
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          committer-from-gh: true
          keep-history: true
          local-dir: built_docs
      env:
        secure: KSG3hnAMLzEh3zCIYeGt+5eJwMaW6aKBeuJ7xO60R9Md4cD83zVZAsvlFRHeChnuD09F9sJzwxDCHlH85M+7tBop57eY+o/eNlRKn7RxDGgWdvApMTc0mWyukW6IrJzggGLmWz2/dAmhKwlKntnhxNBTjjVdg/EoR5KpcPuiUl5O8dSQ2i+33iVlDBxR/B8kDbPou7B4ZH5GuyqRAWMDSCu7VPu4eaRCoqH9qxvLEsk8qrl/gHgmdZ/1xIPc6H8rbz6hMbEmUlcUplDv63V8WHwTdX6MC8tPyWwXXO/VytZGtLG6aWjcsD+74KDpFn6eAUXeEUMNQMFIAy/QAKkL2c2zh7xCUXPUQBWyxDFbVkkNnbGtkHx0GC1OT+EVd2D0S75vpn4ARfUgN31ge6aNEL9NWP3/wOXEAmnY1j1w1T0dVgbsM1Yb+QbzNx4Q24YV51aTSdPE4eOj7U3kBEoZC5OtoR//yExkNHdgxfHXZBGQpqinuBDC6YsGII3A0i5h0UNa63VuW7GUkocpNJzaW27F5BYmROcScDlbrvTWlxFcpw7tBzObZmILuIy2zxwfGRI/OLE5FEp/OcNe9aL92JPhHvVdvBOqo1ShNuzcqC+5Xi8uKJwQIOG4PZr1RY217HGr7uXN9HwaejUFuQtVv1hfxjbF95KjmdqD2XnQJ50=

install:
- pip install -r requirements_build.txt -r requirements_doc.txt
- pip install ./

script:
- cd ./ && pwd && pytest test
- python scripts/build_documentation.py

notifications:
  on_success: always
  on_failure: always
  email: false
  slack:
    secure: fTxYi+g7KKlH8Hhs+r+A7FVoj00J1N2IawIZZNB2L6MSB2/puTL3QKOVF5IprvwKcc2lhAe3dPMinhDYgoBY0AeibaEb4GFf7pGJhnN03sdxTBWMBswePf5eU4dexdpdAMldsqffMDbd7Uo22+j0/k0RhJhX7nTvu4GbUFtv4Gh0yh2nw5dDcD3y4ZLRk1SOAK8xErBZO8x30PNPZze+pjIyVcxfkOE1x2P/TfkY1bkWLDbts5bV4txb0Ycu14uS7lWE7OJvxOltl7fBVLnoCrD36fEtdlQes/ZtRqBQJAbDEXtjCHiJDIm83DY2Oh+hrYKrtIFllfYUlNn+gZM9Z3AWtv6zKYKR18XtK+TqI+NUJrAjsgECgy+RmrP2n2DDnYEFePI3YAAet5ssFv0RkE/+7eJpHZFr8mAopyWFhuxUPnnYHVwwTDMk7XFIGx6DCvjH/NDBgFpEXTfZlJ8E0xscPcUIsHr5B6k6FEZa4Dcyoae6OJ2lYVpHu+MPwA2ohGyaxF02HwLRD2ZGfczWEUTYsbexcV91+GyW/SuJHSAUE78fNu8P/WzX5LwBlmcvczTKwpYj52co5K2r6embQ2WcH0qt2GqBfkQFOl2eP00AgIjyJ9MXJD9Ai9YBbU1585jI6MZ0RYt4HZQsujQhHVSgTf1sy5wEDbhPUgiZ12o=