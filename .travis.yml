jobs:
  include:
    - stage: Test
      os: osx
      language: sh
      python: "3.6"
      name: "Mac OS - Python 3.6"
      addons:
        homebrew:
          packages:
            - python3
      before_install:
        - python3 -m pip install --upgrade pip wheel virtualenv
        - virtualenv venv -p python3
        - source venv/bin/activate
        - python --version
    - os: osx
      language: sh
      python: "2.7"
      name: "Mac OS - Python 2.7"
      before_install:
        - python -m pip install virtualenv
        - virtualenv venv -p python2
        - source venv/bin/activate
        - python --version
    - os: windows
      language: sh
      python: "3.6"
      name: "Windows - Python 3.6"
      before_install:
        - choco install python3 --version 3.6.5
        - export PATH="/c/Python36:/c/Python36/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel virtualenv
        - python --version
    - os: windows
      language: sh
      python: "2.7"
      name: "Windows - Python 2.7"
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python --version
    - os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Linux - Python 3.6"
    - os: linux
      dist: xenial
      python: "2.7"
      name: "Linux - Python 2.7"
      language: python

    - stage: "Deploy"
      if: branch = master AND type != pull_request
      script: python .multipackage/scripts/build_documentation.py
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Documentation to Github Pages"
      deploy:
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          committer-from-gh: true
          keep-history: true
          local-dir: built_docs
      env:
        - secure: pdS/wpaf6nlFLKl4Ewla4uSpYrzx/V66fj9sE39r4SVDtz086Qs5sFVJCN6PpgBZb9dQZL8rI4oC0mwoa5plV4+HX/cB9pnm2/tEEMRrnlyfBg+/YCQX02q2/i9KuROpkQANmj96xLMhR64tmChfLUuZtbOxbH8vNryKyfItrFIBjWm+YN8vMFz3Le/1YYO2f02BZMiEjLT31fTTSsJh22Q9rc4tLOc5cxM+xqotHgbTDtFXhVt7x5yGwK4zMoJuN3k7VkVl3dbWVYjkcLESeyufmD9ZRhWnnpV/xCLAN92hUgHrvrK3e7xhoZVozMv6h5sXD4bYtf9eGPqHZQPG72mIgiW3UOC32u5HeWoa/UAPhXkbDpjlyQGWDfWnP3U50KYIyRh48OU2gvXWmcicISnTkMFyUKJFZAIdgZqdVJpeNdRw1P1oD3H3y6KGXm1550tNhQjJfBkLfojqOV7F310m5K9egaGF7gU1Mfv65v50kQTDhDFYeUmArPEUFY5j+UVsZYOesOxoJTibgZo8QCzdvtlPa4TjjbxFaG7gcv/KNBIFhCpoMaZYB3tyRYjAdii/v9q4CQ8B6IfZVG3eQ31og4z84Ut3so7DCMpfGQQf7cb1AGZGnn8Nx32xe/W+8p1BKNAaP+NPKUPCH/4Dt9LkUFNXTGOpeZEVxCjqfaI=
    - stage: "Deploy"
      if: tag IS present
      script: python .multipackage/scripts/release_by_name.py $TRAVIS_TAG
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Release to PyPI Index"
      env:
        - secure: Ia4doWd4rZYHxopyGxc+8Og143LxxWCWDT6WUr/A9U1jj8cf/u0fvtQHRhluKMyNnvxQiNSo5tyaJkbvn7yCXmTjy7jporaAgL1RrKNrDhvCRCEJxbgqWI77un7reXS2ZoNofRtN/vNF4vTBR5upROlFgdIKaXUbw7YgVHCpLvxwJQNi4bqsCoKDhU1OpWS8VL+lBKai+zd03qXcpumTInrD1DxL1Bt6KrclmBLtWkt4BZRxU2BRYK8LVUGjgoYCYW8oGGE8mzLE/097prXE24BoNB/VSL5KBO1pwPWmQ8Uu5NFEguFI4yTe0ebsYMsKaawTWiatsW3PS60tIzdqEeWcP4u1qSZRX2GRdggwRKG/WhL6sTAymQ/UoiWd0TxRZB/EoMvpCJjWWo+vStE6sDcX3Vf1p/d4WeWWaqcqf28R0XMnYOMt1wm/l6ASraWCk5Da/eYO1JDZ+37W2QFdJJ0IXs7YUkSQgCsi+yBCqZfvyizTyq4iZfi0FFwz/J5pMZK6WST2BJRcBaDl8MA7bWVm0M34doKMMz0sTFbOXm6SJqtnnofUrR7RMnMqvcuSjPvwVkP5qQx/AiayDsEp0oscnfMgVuQV0dl82ijhmBCbcGTuGFTfxB91wsboHWBc2mv9wBzNqsbGY1og03m1FqvjsMyK3oJtUnnNqB8X6J8=
        - secure: iCpXsqea/ioDkSIv2FS+OEXpOs0bGKTl/zT2WFpD1jndVCis3IGqYYlUjAHrHgT8aMEUYO1TJGoWQWFLK6gTVwdGHInGRtBdtAuYoYwZR/ffq9pRtFd+xSrhIqW3z6pt1Ow3lihq5drs4KWrQEMqSSsGzzba5pReJCh9CZyJxa43nLMnOyHTonXAJEDqMh/QdG5f1CZK5yIevbwBNhTrKidcbR3XzVLbJ5c6BJa/NI4fpaSDd1eP7vvtdwZFQ8r0J3L7pZn9MfPeo5t6iJbom76y4M1xSzewBpumO0GrfYYCZY9CgJIguIVkWpR4iI81WIAQRBHihd13zoQlA6GYCZboTtBBBnzPPYGGiimmZXb9scwEXOqSbcyAxAwEHYq3xlli/SObFEF7yzoSxRRACvHsxXjpVo6NAs+AROtBqcBFIgg2Uv5HHck65pGRQPNCo2OGjL04GUSZom/sNrnchNNJQ3884kvoGbuVuPQjoP4HvPt8vW+SN3mibgHru7LxqWRw1Q/eK+kFau4+UB8+aBTGHifcrWofF08AEIUn0PKPelCJVgrWAiBsXD7exsLqnlvA79aYz1+m5n22i11qKpVUJF5EvWF/dM/vSG6gg8ZBWPaNGemfLCk3+l1yVOhJJotZkjWKVBg89miNLUKKAX7N4ZRiaibtPVUGkOjFECo=
        - secure: n58evzr/32azYIHmF25xXD8i7AvGkv5shgyEtQj08Fg5SCMar8Vu9IEtwsoHpOg60VWOiv+/IzpwdA5ZJO/QN9cpa8kpqF/IEZaLoM+uPHJEuP3jMdlDeexAG3vB5Quy+kYXG1b48FghZ0mb+H1EHxvqi4UbW0LQds4xsy1Fprcjsg+OQB8ZgHsGEaQHkcA2gQwyp/vxBIlVTbqcOQiMLMI4b4IlGh+M9Hr1eQRl05CX2SJNMbLSpySdKt7jyiLfldGePms1DEhHOn0PHYYYLDK048eEtg4qbcvWAtocIdNkq88T6CnhrSIG2bpRq+4JOrE/pjC8sKMUx7Trmv5dLNfoxxDXO6smEMYbFSDiPKbOfqnSH2bKMMQDK1puwHPh0Qq8MdMSJDrdE/d5MGOVH7bnXS9aXAVuIjsVpBebDh/QZeYLTiCnhNRNNj35L8p2GPSyKGB+XdwRaFUXhtj3uzXQCAok5djbxJuicK+p4fYgDBc8GtynS8fcAbw+831oWl5RpAOt2CrlN3nsrU8bcvRFVWIKY3ygOEs5bIK43app1Whu8JI1Ldk0bNT0yjQE7ZkltkrEtp7wkwtfmqOBBnZM+Th2Ca1c0tG5s8TFP1CVFoj3hOOKImYuMRrrQK8OhTWBq5hr5s5ROxzw9tKHRr1Rtnd5Bi+uo24J4qjOSTI=

install:
- pip install -r requirements_build.txt -r requirements_doc.txt
- pip install ./

script:
- python .multipackage/scripts/test_by_name.py multipackage
- python .multipackage/scripts/build_documentation.py

notifications:
  email: false
  slack:
    rooms:
    - secure: WlYlXOY0+cDJj39/akHwe2xDn0+z/YGvjJ1BgZQg5P5F4BuWmPEaI/eAAHCyW3ZQ3S4Bqofgv0yL5BvOP2biPqfUoBEvZJJH1OMxZN5LVvpHLYlP+9Cj8py6qqpw60YLxJ4+D2lFQh2ChZ5q30MtSEKbydSooOJqlharUm3DElKSu935pHSyZCiwcNp1A5Ceqwvmz7Bx7HYfld/g8pBG+Snay5TM4wEzgbwUIgq8rUKGNe+xUtWn83jV2YBtbLtGU4t5Vf3Udjy+cu4cFGzZCwQL/e4gsd0A/xwJmoYa0OhX59ehz2KDsBQRA9wET8ZH3OaE7wsjhc4dypqecgImY1WMbs8gkEMl2Mlb7hrU4sV0Ms10BNaTbvXJbDkqUWzeBcuJphi9L1kde7+PLoJEpanggCDV4CARLckYTJVGwBgC0L7ypYxQHhCzQFPKZIfdZ69nJwXRX7dg3IfQ67FxeVXu7F5xn4kFbwlXkYYgEcdvj9Z36DD+NbbsBvO5GP5oukTj0s2kV4fHVFb6vZKKkL06mELjQzwLV589BRkIRlSJE1QxVCxM8S8mmT1kQBT/xXpuID/a4DczimanPCfaoc/YOoR2QpnqOE2xE/CtmK6LlVTNHmfdQtJ9v8ca1tF7+NH9TqNmHtLFt0vN1ooakPxjfqpNvt3u79Hjqr4oqos=
    template:
    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} in PR <%{pull_request_url}|#%{pull_request_number}> by %{author} %{result} in %{elapsed_time}"
    on_success: always
    on_failure: always