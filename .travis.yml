jobs:
  include:
    - stage: Test
      os: osx
      language: sh
      python: "3.6"
      name: "Mac OS - Python 3.6"
      addons:
        homebrew:
          packages:
            - python3
      before_install:
        - python3 -m pip install --upgrade pip wheel virtualenv
        - virtualenv venv -p python3
        - source venv/bin/activate
        - python --version
    - os: osx
      language: sh
      python: "2.7"
      name: "Mac OS - Python 2.7"
      before_install:
        - python -m pip install virtualenv
        - virtualenv venv -p python2
        - source venv/bin/activate
        - python --version
    - os: windows
      language: sh
      python: "3.6"
      name: "Windows - Python 3.6"
      before_install:
        - choco install python3 --version 3.6.5
        - export PATH="/c/Python36:/c/Python36/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel virtualenv
        - python --version
    - os: windows
      language: sh
      python: "2.7"
      name: "Windows - Python 2.7"
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python --version
    - os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Linux - Python 3.6"
    - os: linux
      dist: xenial
      python: "2.7"
      name: "Linux - Python 2.7"
      language: python

    - stage: "Deploy"
      if: branch = master AND type != pull_request
      script: python scripts/build_documentation.py
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Documentation to Github Pages"
      deploy:
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          committer-from-gh: true
          keep-history: true
          local-dir: built_docs
      env:
        - secure: SH2YPWkxxvE4/EjXuSPMklujjgHoaDgN6bJ48UKFnXI8XZET17LRwAK4qau7TER23CItIr7TuO5nWgEIyhAUecqR8mb4BrQjbWBI2OX/dgTmV/HjcJaosKSO1CiHERY+sC2TKlPY4P90Vm2F0UZHFtjj/wHjOK8JUpW+g6tf43BILh1hJ3ETSGHx2EPAD4D6aI3576wVjkCV97QpJjmazniDrOdIfY2z8Bi3Yr1f5piwqIEd5MvbE07KkBTrSfS3xSHJre2GI6HEWackcxCXbXjJeAw7O8ATjP0f6fRmidIHXVOiB5gjL6XFgLPuZH8OIRmWTea0loluYPcZT+aaOl9YSgBcQ5f14LKR5jA0vDlvGQ3iXD5SAck10rAMVnfnPEczMfberioya/wugbRajdVQXrZLywJjJjNtxNgjAVyFZyPBHMUTmjzHK9cj7vm3rdPbT5KJoya4GAcYpwk3h9R9O5y4zGIQUqx96mlTFuFb1gkcx7ve0qj7XumHWGA2bG/NewOp39DJ/fb6Xr4EWpXXCCr4U8Yk8TWkkh+17Fu1I33DtbPk6zSuShDrq8dMDJS1qxmPOcOXKBUYA1humbtKCiuug4CKId5T7/mGpV+fbLvfFYRY4clAfpipSXQ5VqDTAHbiD7F4N1t9XQqgwb/G3Cn1PQG4RdIOz6C2TRE=

install:
- pip install -r requirements_build.txt -r requirements_doc.txt
- pip install ./

script:
- cd ./ && pwd && pytest test
- python scripts/build_documentation.py

notifications:
  on_success: always
  on_failure: always
  email: false
  slack:
    rooms:
    - secure: rw21MX1wqIZQwTJkk7GyINeDBEscRg6/tY8FMPacLxG/L9ApeeFxmKrWV1EePdz3zYzEdNMbfarXaN44OCTNyqIA7jCfI576FDiL8dGKJmoLgL/8IzCEJPxfwLcvC6BGwx+z5Y2chURzHVAHDLFCQRkHqJSNaj4dLgS7z7n5UIz2GQrTLJDN3Imwvt8y9qVDFhr0dgdo6TreSuanziR4tpLVryZJgOsSTKnxVOlnDLG77osqcVDcqGffpdJnMYBwoKjDl8rIqzrNJPGk9fYdqRHWNaM6LMmqkXoG3fkL1DH30++o8iXOq/B/VknTt6jq8JnU8w83cqgh3rbPrScZhXA06h8apbgvVdcK53Y/LhHK7n6EuU2l76tLwc1gztLUROgIlU2tI7UdaAlb8dMttfCykuH7eicTIdLpiInHhMiI9nmI6ch6y4gVjP+OJVBWU3c9CFxZvDYJoSYp7BgNJvNF/Ve6K4qHXrt7VtVG6nBwdS/S6JR4aDNz99Pm9vDhAPcpLxZrouQ2nVDg7bkZsqoFKFVvCoRsMlKw8bOCc3Xd2q4huVXczrniDi9F98MA1e9YUvsjvrx5Ibf66K8D7jYcQW3Q1iTK4fGejz0WFe7uDGHPWmZxu9KgzfBjyYtdv3bmwW7XH0tInOA+IFZYql6q/bpKr+BAfsZ63AW3jUo=
    template:
    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} in PR <%{pull_request_url}|#%{pull_request_number}> by %{author} %{result} in %{elapsed_time}"