jobs:
  include:
    - stage: Test
      os: osx
      language: sh
      python: "3.6"
      name: "Mac OS - Python 3.6"
      addons:
        homebrew:
          packages:
            - python3
      before_install:
        - python3 -m pip install --upgrade pip wheel virtualenv
        - virtualenv venv -p python3
        - source venv/bin/activate
        - python --version
    - os: osx
      language: sh
      python: "2.7"
      name: "Mac OS - Python 2.7"
      before_install:
        - python -m pip install virtualenv
        - virtualenv venv -p python2
        - source venv/bin/activate
        - python --version
    - os: windows
      language: sh
      python: "3.6"
      name: "Windows - Python 3.6"
      before_install:
        - choco install python3 --version 3.6.5
        - export PATH="/c/Python36:/c/Python36/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel virtualenv
        - python --version
    - os: windows
      language: sh
      python: "2.7"
      name: "Windows - Python 2.7"
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python --version
    - os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Linux - Python 3.6"
    - os: linux
      dist: xenial
      python: "2.7"
      name: "Linux - Python 2.7"
      language: python

    - stage: "Deploy"
      if: branch = master AND type != pull_request
      script: python scripts/build_documentation.py
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Documentation to Github Pages"
      deploy:
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          committer-from-gh: true
          keep-history: true
          local-dir: built_docs
      env:
        - secure: g3wxArcYelVAlwmDNTimzMRPT7utqlQ7bIURliyMzKuaMHP3CiY0BDQlzlbRH9zwIauJbFGeH7ST6Uy4Jn6rCo07naFZCWUgJurn8lTRtMMPPujch4TahTKN4Gd18LRZLTZCbGoNIiJYMt4b7iv3vr1UNi5J1d8wLnQ4q09O9eDX7D8l1opkXgSUIUuy7qfz10RwbCU+WCD1pECZUBkgK4bLgyS0xyRz/jZV4RAylGunX/28z8or3SbH31jwy+OzuceurkpT2SyZG02unCJijP0tN21JaAZPBQWJsmNvIzp8qfoLCXqxJi6++VbEQMGsu8CBDABoQnMep4BfM+GlOq4RcghtIuxt6NE835ICq4ZtNbDwpj1NOe+gdLGvv7USwNRtLuaMcp07cVxvd2RwUcHKVN+6GuoJtiPnEdN+U2oRtSLEXZb0mBgwny97aqJPUSYR3jxEo2ZfFYe9vC9H6cR8pIHLWH6NJKiUkK8t2spgvyVLGNO0zahdKDVS6vu3GpgA6Ca3FQDYy15pBUNMmjWpYq76Ts8zOTPVeU6FRLlyfEZAHM2l0mfxm41R8DnlgcPFbck9zGyRJbfBQVHjk6dIGssqhN6oDMIrBUXWboyY7HR5xNV9KrxkZ7/nrq+6RrU69p2Kq1CgwmKAeODmf2us87S6h8VQztr4k8+Yxwc=

install:
- pip install -r requirements_build.txt -r requirements_doc.txt
- pip install ./

script:
- cd ./ && pwd && pytest test
- python scripts/build_documentation.py

notifications:
  on_success: always
  on_failure: always
  email: false
  slack:
    secure: CIAZeqVvEe732djq1Y5lR7XBrIDWkfw3M962feQPHhcXvItJXSBp/T4N1//6Y9NyqrTtTzHyQujcC0QhbJdzO9jl2BGThjosVLhfqCYU8o8S1HwQEq9QPPbPofD4pDs52E9+2Vx6vVkBGWdzEhXjFtCnbwxYPn7AMG7oFPcAAFLoDhbxoawvVBsCYmkilib0gHgZvVT/VQq317r687XzbbTIZPBmZbazZbQIrT/EBp1HjK7bhDDYESb+3RIgvqFkihL3mVIEZGLBN1vNVtJ2cH2zm7FVz3JNTRJBpTbh7naBRaqdjSUqiMO/Dp/jxZWp76sPpzRsl2BQPI4nd72lSk8XPE1ogTRqfLSG0sO0fydLwtrczSAiMLbk3GS/jRoWKNfZtAP3sC545HhTpCHL93P65X/7VcMnCeCcAwXnP9gCFMzhQtVydW8t0rLtMAMJWtfgV/ODi6V87xFr8iQ7QFBKXDnAV6/6sEp9zi7X4t06NqiN4aLoRnQ0LSUtG6VmDOQw0AG5V/FC8ZOBmRBhtBP42xTQR9WGWZdejI7mcTpDluica595tqZJ4CsREVsVcqk/0ZzZ4VPqda8W/gIKqhlRmHftTCDBb5KukOd1C2I3lmY3nkvwpoks/t5L/G/1oTe0VuhJ5wTNSuz1FPeay73jQWMeSX70hZjM8fMJgM4=
    template:
    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} in PR <%{pull_request_url}|#%{pull_request_number}> by %{author} %{result} in %{elapsed_time}"