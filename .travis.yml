jobs:
  include:
    - stage: Test
      os: osx
      language: sh
      python: "3.6"
      name: "Mac OS - Python 3.6"
      addons:
        homebrew:
          packages:
            - python3
      before_install:
        - python3 -m pip install --upgrade pip wheel virtualenv
        - virtualenv venv -p python3
        - source venv/bin/activate
        - python --version
    - os: osx
      language: sh
      python: "2.7"
      name: "Mac OS - Python 2.7"
      before_install:
        - python -m pip install virtualenv
        - virtualenv venv -p python2
        - source venv/bin/activate
        - python --version
    - os: windows
      language: sh
      python: "3.6"
      name: "Windows - Python 3.6"
      before_install:
        - choco install python3 --version 3.6.5
        - export PATH="/c/Python36:/c/Python36/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel virtualenv
        - python --version
    - os: windows
      language: sh
      python: "2.7"
      name: "Windows - Python 2.7"
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python --version
    - os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Linux - Python 3.6"
    - os: linux
      dist: xenial
      python: "2.7"
      name: "Linux - Python 2.7"
      language: python

    - stage: "Deploy"
      if: branch = master AND type != pull_request
      script: python scripts/build_documentation.py
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Documentation to Github Pages"
      deploy:
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          committer-from-gh: true
          keep-history: true
          local-dir: built_docs
      env:
        - secure: p5ePx2feFKP6GRfvJbKeN6dFmc6JvakVA48MAB23AEdClPvM5uYG4KlJRub13a3E3oKZTr0jRxOUC/jj2pMUipUdSoW9TN3EfAN4SEZbDdkOA0dAwgBnVgIgVk7s8UR4aXw22kI+CPMFolFJsqMB5dc7vGJltiSYr9z0+JVxkBzx+DPMXYfpp+kToRCOw8Zm/dFn25K9WXwScJPnWjc73rGso9K/NX7UwKwu7IcRduRMy1DFmBob8BJzNLN6xWiKC2KcCkFgUeJboxvuApwe2EjmREHg1soN+a8b/Y3G7qdOi7Ba29ktoVayegLGX22xoKOE4MnM8PppGyI6DVWWskp21UWW0hak5bkxApJMDM5fk1dJ8UiMlUD2Qp78rmwqbrW7EgpuMQn8S5/kVcG6Yt3NKdHC9EFkPB32BLLWXQdMN4wKERVavG4peJ7f+q6fxSBk1L8txMo99z51Sf8tYKACRlaYKQDIZ9la6QQchhzXAYP+gDwz5wgg3s4ulTlyebLUeDZC6cVSRIQ/IeXODpER8R3N+M3gzWPb0rRJIv/DYDoty8fK+RCBrjkggu0+Lkmtf0nYF69PeNjHIwYFEXOMjUWfJRh7cKo7SX0V7MzEC6Y8p+2nKWQHTUMXKmNThrADF9WPZVi2cuCXaQEVqLAUDGkc4ivTX+2Gz/PYbDM=

install:
- pip install -r requirements_build.txt -r requirements_doc.txt
- pip install ./

script:
- cd ./ && pwd && pytest test
- python scripts/build_documentation.py

notifications:
  email: false
  slack:
    rooms:
    - secure: dYfxekDPGReSuDWv5/RXlhzxI3wh4KG0YlNZ+abhH24SyHHuXfIhc2A2YQZBzg2ABV/cNS79JHNLL44Pl+dGRAXigNpVgC7++d6hz84IRj2pPVZeI0IoES3SfREc60qzfQZUA1dhVu79mfwNH4er7nPfOefYNcXeO0htizmxLKLuMTEEEjty5fNJpI5CEIPBvxkSMDkO15wwtxEZvwCRr75HA2VK3jeTj0F4S0hm80GUFelxeCxTsMJHsEhWxRBAvqmg9OIVpf4NIbSuKeu0R87OQkofJCuFGTx44SsYmECpmAImDgm3qFa+bXhQrkcAQa6zIUeMQUInPCtynoWOuAOBx4cGci9lAcQuFWswV2sLDZgKlqbXbBV3n+0sqLVoEdvaAI0M2Tu89n6xnnnl8XQTNBLUXFvv5z8o7XQ439Q776f1zOHmUlZQ5gJnrhZf8Jqf/Rk9riTrz6O8lOHkeUvQOdcWNs4crSVdg7ppelgevPp9PSu2L0RCt6ByxsHXWraemt+Gb5QkZ1thIL+K/tpqPxnHILJ76sU9gsBc7SLAci8gKcrTM/aRmy8YmPwOt1sYlnuqtPAqOjt4Rb3DrkZQQ4OmVLeTUUqhbz4Nnchz30Lho5fySDUXHgkTP2SL5rk/NnrEaBrD8/+NvY4uPwwYXbvuxzZRvdU53Q4tlZ0=
    template:
    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} in PR <%{pull_request_url}|#%{pull_request_number}> by %{author} %{result} in %{elapsed_time}"
    on_success: always
    on_failure: always