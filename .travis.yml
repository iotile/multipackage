jobs:
  include:
    - stage: Test
      os: osx
      language: sh
      python: "3.6"
      name: "Mac OS - Python 3.6"
      addons:
        homebrew:
          packages:
            - python3
      before_install:
        - python3 -m pip install --upgrade pip wheel virtualenv
        - virtualenv venv -p python3
        - source venv/bin/activate
        - python --version
    - os: osx
      language: sh
      python: "2.7"
      name: "Mac OS - Python 2.7"
      before_install:
        - python -m pip install virtualenv
        - virtualenv venv -p python2
        - source venv/bin/activate
        - python --version
    - os: windows
      language: sh
      python: "3.6"
      name: "Windows - Python 3.6"
      before_install:
        - choco install python3 --version 3.6.5
        - export PATH="/c/Python36:/c/Python36/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel virtualenv
        - python --version
    - os: windows
      language: sh
      python: "2.7"
      name: "Windows - Python 2.7"
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python --version
    - os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Linux - Python 3.6"
    - os: linux
      dist: xenial
      python: "2.7"
      name: "Linux - Python 2.7"
      language: python

    - stage: "Deploy"
      if: branch = master AND type != pull_request
      script: python .multipackage/scripts/build_documentation.py
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Documentation to Github Pages"
      deploy:
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          committer-from-gh: true
          keep-history: true
          local-dir: built_docs
      env:
        - secure: wWt3nlXon2A8IKPf3Vz5Ou4K9QWvyE7khhRHKqnTOgFahsYwzmdgc0eW8+ePvt/peoZQ0RtDXSUAwl/TjrJt1iDXvgmXGPJclId8WiuK6nBNq/XL0sGwXmDBrV+Xa70K4g8sbFl52VIbe0R8sgxT8JPu6wRocnXYF2FQ9wol3Wwwxn4owkzFK03HBZ+amldM9kO7c3uDk3mfTaqs201FG0veT3R70R2aLCSneBfk0UXrRlMBfRYhTzfDz0+Fy8w0SWV7OH2Tu+Z5F1iwWUVkVXp8ZmPifRKbIQ4wptMEQqLcBY/0vHTcSldc+gUlayWf8HRJQ0U8DRmJHaeHb7CcewKp9luZ6aroPoo8TmDvQnZ9I7u4SU2kELVOeJxiInMi7Wtcv4+hY1yVMncsH2vVj5JOFei9dOK8tR1P+nZFDCPUOgktZ+cvTS/gdZ2u3oH4fnbnUj7gRWqBuGzmvPm2PQmQSJeq7jDIKb70eAeNj06oA3bjgQpGwCRiv//QvkIc45+i1Nk2wicHApj2IFVCb+A/wfrIOu/49nNlXvsq29lpqYYg73HB9pGTd/9Gwvb/96YJyrSh+oZhbb9MxJT3dbtoE1Y7Q657zpL7qNByhIt+TWmO/Mcr6EoKjTwohAy103viXDLyPpI2rd89gH3Knk26Us1VjrqJGBQJ4m77ul0=
    - stage: "Deploy"
      if: tag IS present
      script: python .multipackage/scripts/release_by_name.py $TRAVIS_TAG
      os: linux
      dist: xenial
      python: "3.6"
      language: python
      name: "Release to PyPI Index"
      env:
        - secure: giV/6/nhge/PCkiShJ3vMRlodzUYDFS0T+OAskGJyoQISZ7igm1gWWGbkcJuwGCNIYb4jZY4jTVUtwnjbbzRVgV6o0ugG+17wc6fRoPUI65SlPckEh7lPNaOnfqsJM5oveWAmlfyIUEXsPHAOCGr3DPTzWjzhstXOc+f5fRGDf62OWa/6NP0fnQEilADo1g1Q2ZDbWwwZY0/w/3YaXQTycGOgSy2VMaTIn52OKmEKAUXG/EvLoPyTUlQHuiWfH6RLdpTQ0mB+gFJHPIkgC7XB8Z1GLkk4an9J4AbkGedmh4oZgc1D6QsTm1h6mOA6LuO3uXAuBs+VPuZ4BseL0u2cdNQxps5iE2GcfGywfAaRVp609PCQQVTABOXVpunPnUkBpmaxb6OOIBcQJrZpMAH30WFHRMfu4CovqsIWKKtuDnWb6e7ywFDTOyy+fIQpNH5Ghf010yNA7HnsYoT6LXcV0xyeUbx5UnVx2yv/nfVM4xrGhM+6eO4EQPoGFnQdud9n6/i+CcF6ItBP9W0SQvMxeZXcsnE9t+nn6+P/jWJw5kq67Lu3C1HKNwN+XBlP6nMVDULKJF9ISTEL5F/bkLThtTFBOVOkEUwrLAAISJQbWWv+fICDIHNDZL3au4OiE7Vcs/Ybnbiq3LbDRGKXHGQ45yV2lVZI/Vm3Jx4p67RA+Y=
        - secure: DS5kEvhfOPUzLJC9eMXkAovPUNrtuTIHboGod9XT2UWTgfwsj1NI1Dl0S5UK/a2GVAUKQps04bZHGIJ5GP4bGpjbwI5aZ0/xad2hKOoFxZG+XJQLBFIKRick5uwMuIpJZAX7lFakZqaqj8nHlxSLHg7qablhsbjFCabkqjbnm2hwzkEF8Dufsz5tUQ6psej/L95fJU+dfIT34VtVOZEamT/385zLUMZeDU/ivjAwPWfdG2HhUKGDZ30Dlbej0b3rJ3bW0EWrel1oVI44q5M0/aECP+0PwPHsTuEEgo6HLZiVQyIm/3tVCzHmfAkzpbN4dB5M5teK8AbJiNvemBFJ1woVX6ZUTYSTJ7Jrh0fwjpJpKY8Z8RZixv3Zv9H8cpLzjrWoE4/5EvOk+qY2z6weF6AvQeySn9eL38pEY/4T8TQKB0h+fPnhJJut3mFKQiItaeLsKWOIQBw0ohgU7N4zAOUH/b82Koq6/ZNhjVRW8qCoRvZWGq+M21OA/Xbs9GHQ2EmEdQg7rfiTRkPq/Zw/qwoU5e86B4dJAYv+BghwmhYErTQB4nw9b5x4lZcN5vn3S4h1SUTAua2OsBi3u+6vRfJKEr3Agc4F5mS5AEZ49aRXsw66XFSZLc1V4jHtab0YLOVXIGzT9h4u0mb3DOt5+44omVL0NcVXurpzk9oC5oE=
        - secure: wl27uogxam+YQyLYuGxnA051ke7kY7lc2/iGgR4qhAFGDFQc61gyQWLZ7t6ohxGYbGEqjtXCEs6ogNcFJvgnEVrmtllxrbXLMwylHaduie7wEV3QVfPISAbqxTaB8SBE3DoA8nqFBmVFliE2AOdhCnY73THWAQp1uCjLeY4rAvfHLZpVrmhCnhKofEO3PKw/Ivj5YWCGGWNSGKl9R7/ToE7qIGlhCQ2hXNwnAjPJ4KaKVdPls/OkEgeSAlKCb7gKT0mGAYCs2yAz3+w5NVCJAEu7mj++qEtIP5yheit+f5eiNJtRt21qZ13Mw1Zq9POcSHTJwid5PCua444hliA5lPf3DYI1bjy6h5aPqTFxVILq2Tbrl79y2V92m/sl0HY+rdOHeOhFiwioDXph7Fm/xGEIHrvdUFdR5vTJXOmCCUQd+olLszPjMq2k/mBxZ+8k3jZ4aMd9neo6na6jNNLaxVyTXTojxZnrhyUAw5nrvl2HJ0AAk2qhBMqbDmnGisbWO0xrZpKr+EgY+i0SPDOIGdD3zFnS0UkKMbSBvDkTFMzjq2NpgAJqiA5GPfQkZ6k+anVenL3bvgKZV3mbBt8xPWuUfpjzF1wJk1Bqf1s2Cvn2vSRwpqWGrogFasP7Qp6z1TEfgtoTm3ts2dCz09NVXs1QiZtyaur/tk02cX1AaXg=

install:
- pip install -r requirements_build.txt -r requirements_doc.txt
- pip install ./

script:
- cd ./ && pwd && pytest test
- python .multipackage/scripts/build_documentation.py

notifications:
  email: false
  slack:
    rooms:
    - secure: MCIfMDNsRUgJoZk7GHo8Tvat+gnxuxqWTxsMNUTtfFyjv5CLy9P1gU5URTnlaZlznPuNo/QNeJEqFGTBC+ZgpUWvtdwyvLR48toT9vCPlvFBJR0eFOe5Oad6ptg215hNB32W6/bPFZ/LBO51rnPYXGwC7+mRlR2EmVoQMMgY+xQ7QkoD3QEieqybV/ty7/YgcygJKumKUJFOAqfWVWfO/Mn5Iad/VBxLjMCzA7QC4cKHw0JlrYD6jlNflPNj5fVDLBLjEZPEaZiVWPqMuKeIO6/XKznMJH4jMK+rqdBtHoFpBP/z6d71HdTUq7rnZzVNg9m2t0XdGo/UsNHLNZrSGjv4Q7i0uG8YYsvmq3kjpY5FUSO68usBIZUCP2+gBdG7UL+06p6nCA2LYWAxzBzAIBbKjV0j5C/9G92PHgbPbV2b49sxkVmUO0wuMtohp4Ry0ATT1uoCkkLXBPTbbQi2SkQ2ZfM+MAQO6cPMNGUYtMH+HNeicrcogWA3fXZ0PxQyql2holKF/fiLQlD5jPvSL6eUB0QcinM4KMWMTrhxYz8OJOLnys52XVocooiV/qhtuWAPGmgCWMyUfNpbLoHMM/0896BhRBZXbhb0S7zobTchZGVzyuEhooK800k0IYG8BTs55Ufs8CpLSoOJthK82dw99xDCa38CbLBTr6q2zsk=
    template:
    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} in PR <%{pull_request_url}|#%{pull_request_number}> by %{author} %{result} in %{elapsed_time}"
    on_success: always
    on_failure: always
