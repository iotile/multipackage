# CLI Tool for Managing Multi-Package Python Repositories

<!-- MarkdownTOC autolink="true" bracket="round" -->

- [Introduction](#introduction)
- [Usage](#usage)
  - [Required Environment Variables](#required-environment-variables)
  - [Optional Environment Variables](#optional-environment-variables)
  - [Setting Up a Repository the First Time](#setting-up-a-repository-the-first-time)
- [How It Works](#how-it-works)
- [Continuous Integration Notes](#continuous-integration-notes)

<!-- /MarkdownTOC -->

## Introduction

This tool is designed to automatically setup or update a github repository that
contains 1 or more open-source python packages that should be published to PyPI.

It is packaged as a python package distributed on `pypi` that includes a bundled
cookiecutter template and a console script named `multipackage`.  The
`multipackage` CLI can be used to initialize, verify or update the build, test
and release scripts for a given target repository.

Out of the box `multipackage` comes with:

- Well-formatted prose documentation using `sphinx` that is autodeployed to
  GitHub pages every time there is a commit on `master`.
- Cross-platform testing using Travis CI on Python 2.7 and Python 3.6 on Mac,
  Linux and Windows.
- Documentation testing and automatic building as part of the unit test suite.
- Continuous Deployment to PyPI on tagged master releases.  Multiple packages
  per repository are supported and can be released on independent tags.
- Support for repositories containing multiple python packages in a nested
  folder hierarchy.
- Easy updating of repository build scripts with new features by just running
  `multipackage update`.
- Ability to automatically fail the build if linting violations have increased
  (disabled by default).

In order to do all of the above things well, this template is pretty opinionated
in what it assumes your python code will look like.  In particular it currently
makes the following assumptions (i.e. if your python code doesn't work like
this, this template will not work well for you):

- Package testing is performed using `pytest`.
- Package linting is performed using `pylint`.
- Documentation is written in ReST and built into HTML using `sphinx`.
- Packages are to be released to PyPI on Python 2.7 and Python 3.6.
- The CI and CD service will be Travis CI (open-source version)
- Release notes will be tracked per package in a `RELEASE.md` file.


## Usage

### Required Environment Variables

In order to set up the CI service correctly and properly encrypt PyPI deployment
credentials, the following environment variables need to be set when you run the
cookie-cutter:

- **PYPI_USER:** The PyPI username you want to use to deploy your package(s) to
  PyPI.
- **PYPI_PASS:** Your PyPI password.  This will be encrypted as a secure
  environment variable and stored in your .travis.yml file.
- **TRAVIS_TOKEN:** An API token for Travis CI.  This is needed to get the RSA
  public key for your target Travis CI project.
- **GITHUB_TOKEN:** An API token for GitHub with push access to the repository
  so that we can deploy the documentation to github pages.

**If these variables are not set in your environment, the cookie-cutter will
fail.**

### Optional Environment Variables

If you want some additional features (like slack notifications), you can also
set the following environment variables:

- **SLACK_WEB_HOOK:** A web-hook that will be used to send `on_success`,
  `on_failure` and `on_release` notifications.

### Setting Up a Repository the First Time

TODO: Insert link here

## How It Works

> This section describes the specific details of how `multipackage` sets up a
> repository, what files it installs and how updates work.

The `multipackage` system installs the following directory structure in your
repository:

```
doc/
    <your prose documentation goes here>
    conf.py - Autogenerated sphinx config file that should not be edited
    api/
        <autogenerated api documentation will be put here>

scripts/
    multipackage_manifest.json - manifest file parsed by multipackage
    <autogenerated scripts to control the build process>

.pylintrc - Default pylint rules for this project
.travis.yml - Autogenerated Travis CI configuration
.gitignore - A portion of this file is managed by multipackage to exclude files
             that are autogenerated and should not be committed.
```

It also reserves the following directories for temporary use during builds.  You
need to make sure that you don't use these folders for any other purpose in your
repository:

```
built_docs/
.tmp
```


## Continuous Integration Notes